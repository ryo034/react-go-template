# テスト方針に関するアーキテクチャ決定記録

## Status

accepted

## Context

課題感や背景などはないが、アーキテクチャの説明として記載しておく

## Decision

以下がテスト方針：

### APIとフロントエンド共通のテスト方針
- **Playwright**を使用したAPIのインテグレーションテストの実施
  - API側のスタック（Golang）でテストを書くこともできるが、Go以外の言語を選択する可能性など疎結合を意識した際に、API側とは独立した形でAPIのテストがある方が良いと考えた。
- **Gauge**と**Playwright**を使用したE2Eテストの実施
  - Kotlinを用いる方法もあるが、フロントエンド側のテストは基本的にはフロントエンドエンジニアの持ち物になるので、JSで書かれている方が好ましいと考えている。そのためKotlinではなくJsで書いている。
- 全ての変更に対してTDDを適用する
- GatewayやController、Presenterなど変換レイヤーにAdapterを使用
  - Adapterを挟むことでテストコード内に他のクラスや余計なコードが入ることがなくなる
- UseCase層のテストは行わない
- API固有のテスト方針
  - **Driver層でのテスト実施**: Dockerを用いたデータベースでの実際のクエリ実行を含む
    - 単体テストとして実行できるが速度が遅くなる。そのため、DBに接続してテストするのでCIではコミットごとではなく、デプロイ時に実行するようにする
    - Driverのテストは冗長に感じられるかもしれないが、レイヤーごとにテストを書くことができるので、早くバグに気づくことができ、よりインクリメンタルに開発することができる
  - トランザクションはAPIのインテグレーションテストで担保する
- フロントエンド固有のテスト方針
  - Driver層のテストは行わない
  - コンポーネント結合テストを厚くする

## Consequences

この変更により、以下の点が改善されます

- **テストの品質向上**: TDDの徹底により、コードの品質が向上し、バグの早期発見が可能になります
- **テストの一貫性の確保**: 共通のテスト戦略により、APIとフロントエンド間でテストの一貫性が保たれます
- **効率的なバックエンドテスト**: Dockerを使用したDriver層のテストにより、より早いタイミングでのクエリのエラーなど肉付くことができる
- **インテグレーションテストとE2Eテストの明確化**: トランザクションの担保とユーザー体験の検証が明確に行われます
